(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function o(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(e){if(e.ep)return;e.ep=!0;const n=o(e);fetch(e.href,n)}})();const E="f6450ebcd6924ffc380648dcf77b28fb";let y=[];async function b(t,a=3){let o=[];try{for(let l=1;l<=a;l++){console.log(`Obteniendo ${t} - página ${l}...`);const e=await fetch(`https://api.themoviedb.org/3/movie/${t}?api_key=${E}&language=es-ES&page=${l}`);if(!e.ok)throw new Error(`Error HTTP: ${e.status}`);const n=await e.json();if(o=[...o,...n.results],l>=n.total_pages||l>=a)break}return o}catch(l){return console.error(`Error al obtener películas de ${t}:`,l),[]}}async function k(){return await b("upcoming")}async function L(){return await b("popular")}async function I(){return await b("now_playing")}async function M(){try{console.log("Obteniendo películas de múltiples categorías...");const[t,a,o]=await Promise.all([k(),L(),I()]);console.log(`Películas obtenidas - Próximas: ${t.length}, Populares: ${a.length}, En cartelera: ${o.length}`);const l=[...t,...a,...o],e=Array.from(l.reduce((n,s)=>n.set(s.id,s),new Map).values());return console.log(`Total de películas únicas: ${e.length}`),e}catch(t){return console.error("Error al obtener todas las películas:",t),[]}}function B(){return new Date().toISOString().split("T")[0]}function x(){const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-01`}function w(){const t=new Date;let a=t.getMonth()+2,o=t.getFullYear();return a>12&&(a=1,o++),`${o}-${String(a).padStart(2,"0")}-01`}function D(){return`${new Date().getFullYear()+1}-01-01`}function S(){return`${new Date().getFullYear()}-01-01`}function h(t){const a=document.getElementById("search-title").value.toLowerCase(),o=document.getElementById("release-date-filter").value,l=document.getElementById("sort-by").value;let e=t.filter(s=>s.title.toLowerCase().includes(a));if(o){const s=B();switch(o){case"upcoming":e=e.filter(g=>g.release_date>=s);break;case"this-month":const c=x(),i=w();e=e.filter(g=>g.release_date>=c&&g.release_date<i);break;case"next-month":const r=w(),u=new Date(r);u.setMonth(u.getMonth()+1);const d=u.toISOString().split("T")[0];e=e.filter(g=>g.release_date>=r&&g.release_date<d);break;case"this-year":const m=S(),p=D();e=e.filter(g=>g.release_date>=m&&g.release_date<p);break}}switch(l){case"date-asc":e.sort((s,c)=>new Date(s.release_date)-new Date(c.release_date));break;case"date-desc":e.sort((s,c)=>new Date(c.release_date)-new Date(s.release_date));break;case"title-asc":e.sort((s,c)=>s.title.localeCompare(c.title));break;case"title-desc":e.sort((s,c)=>c.title.localeCompare(s.title));break;case"rating-desc":e.sort((s,c)=>(c.vote_average||0)-(s.vote_average||0));break;case"rating-asc":e.sort((s,c)=>(s.vote_average||0)-(c.vote_average||0));break}const n=document.getElementById("results-count");return e.length===0?(n.textContent="No se encontraron películas con los filtros seleccionados",n.className="alert alert-warning mb-3"):e.length===t.length?(n.textContent="Mostrando todas las películas",n.className="alert alert-info mb-3"):(n.textContent=`Mostrando ${e.length} de ${t.length} películas`,n.className="alert alert-success mb-3"),e}function f(t){const a=document.getElementById("movies");a.innerHTML="",t.forEach(o=>{const l=o.poster_path?`https://image.tmdb.org/t/p/w500${o.poster_path}`:"/public/no-poster.svg",e=o.overview?o.overview.length>150?o.overview.substring(0,150)+"...":o.overview:"No hay descripción disponible",n=o.vote_average||0,s=C(n),c=document.createElement("div");c.className="col-md-4 mb-4",c.innerHTML=`<div class="card h-100">
            <div class="image-container">
                <span class="rating-badge">${n.toFixed(1)}</span>
                <img src="${l}" class="card-img-top" alt="${o.title}" 
                     onerror="this.onerror=null; this.src='/public/no-poster.svg';">
                <div class="overlay">
                    <p class="card-text">${e}</p>
                </div>
            </div>
            <div class="card-body">
                <h5 class="card-title">${o.title}</h5>
                <div class="rating-container">
                    <div class="rating-stars">
                        ${s}
                    </div>
                </div>
                <h6 class="card-subtitle text-muted">Fecha de Estreno: ${o.release_date||"Sin fecha"}</h6>
                <a href="https://www.themoviedb.org/movie/${o.id}" class="btn btn-danger mt-auto" target="_blank">Ver Más Info</a>
            </div>
        </div>`,a.appendChild(c)})}function C(t){const a=t/2;let o="";for(let l=1;l<=5;l++)l<=Math.floor(a)?o+='<span class="star filled">★</span>':o+='<span class="star">★</span>';return o}async function O(){try{console.log("Inicializando aplicación..."),y=await M(),console.log("Películas cargadas:",y.length),f(y);const t=document.getElementById("apply-filters");t&&t.addEventListener("click",()=>{console.log("Aplicando filtros manualmente");const r=h(y);f(r)}),document.getElementById("clear-filters").addEventListener("click",()=>{console.log("Limpiando todos los filtros"),document.getElementById("search-title").value="",document.getElementById("release-date-filter").value="",document.getElementById("sort-by").value="date-asc",document.getElementById("date-filter-btn").textContent="Seleccionar filtro de fecha",document.getElementById("sort-by-btn").textContent="Fecha (Más próxima)",f(y);const r=document.getElementById("results-count");r.textContent="Mostrando todas las películas",r.className="alert alert-info mb-3",v()}),document.getElementById("search-title").addEventListener("input",()=>{console.log("Filtrando por título");const r=h(y);f(r)});const a=document.querySelectorAll("#sort-dropdown-menu .dropdown-item"),o=document.getElementById("sort-by-btn"),l=document.getElementById("sort-by"),e=document.getElementById("sort-dropdown-menu");console.log("Estado de los elementos del dropdown de ordenación:"),console.log("- Items encontrados:",a.length),console.log("- Botón ordenación:",o?"OK":"No encontrado"),console.log("- Input escondido:",l?"OK":"No encontrado"),console.log("- Contenedor dropdown:",e?"OK":"No encontrado"),o.addEventListener("click",r=>{if(r.stopPropagation(),e.style.display==="block")e.style.display="none";else{const d=document.querySelector(".custom-sort-dropdown");d&&!d.contains(e)&&d.appendChild(e),e.style.display="block",e.offsetWidth}}),a.forEach(r=>{const u=r.getAttribute("data-value");console.log("Registrando evento para opción de ordenación:",r.textContent.trim(),"con valor:",u),r.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation();const m=d.target.getAttribute("data-value");l.value=m,console.log("Aplicando ordenación:",m),o.textContent=d.target.textContent.trim(),e.style.display="none";const p=h(y);f(p)})});const n=document.querySelectorAll("#date-dropdown-menu .dropdown-item"),s=document.getElementById("date-filter-btn"),c=document.getElementById("release-date-filter"),i=document.getElementById("date-dropdown-menu");console.log("Estado de los elementos del dropdown:"),console.log("- Items encontrados:",n.length),console.log("- Botón filtro:",s?"OK":"No encontrado"),console.log("- Input escondido:",c?"OK":"No encontrado"),console.log("- Contenedor dropdown:",i?"OK":"No encontrado"),s.addEventListener("click",r=>{if(r.stopPropagation(),i.style.display==="block"){i.style.display="none";const d=document.querySelector(".dropdown-overlay");d&&(d.style.display="none")}else{const d=document.querySelector(".custom-date-dropdown");d&&!d.contains(i)&&d.appendChild(i);const m=document.querySelector(".dropdown-overlay")||$();m.style.display="block",i.style.display="block",i.offsetWidth}}),document.addEventListener("keydown",r=>{if(r.key==="Escape"){if(i.style.display==="block"){i.style.display="none";const u=document.querySelector(".dropdown-overlay");u&&(u.style.display="none")}e&&e.style.display==="block"&&(e.style.display="none")}}),document.addEventListener("click",r=>{if(e&&e.style.display==="block"&&!e.contains(r.target)&&r.target!==o&&(e.style.display="none"),i.style.display==="block"&&!i.contains(r.target)&&r.target!==s){i.style.display="none";const u=document.querySelector(".dropdown-overlay");u&&(u.style.display="none")}}),n.forEach(r=>{const u=r.getAttribute("data-value");console.log("Registrando evento para opción:",r.textContent.trim(),"con valor:",u),r.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation();const m=d.target.getAttribute("data-value");switch(c.value=m,console.log("Aplicando filtro de fecha:",m),m){case"":s.textContent="Todas las fechas";break;case"upcoming":s.textContent="Próximos estrenos";break;case"this-month":s.textContent="Este mes";break;case"next-month":s.textContent="Mes siguiente";break;case"this-year":s.textContent="Este año";break}i.style.display="none";const p=document.querySelector(".dropdown-overlay");p&&(p.style.display="none");const g=h(y);f(g),document.getElementById("results-count").scrollIntoView({behavior:"smooth",block:"start"})})}),v()}catch(t){console.error("Error durante la inicialización:",t)}}function $(){let t=document.querySelector(".dropdown-overlay");return t||(t=document.createElement("div"),t.className="dropdown-overlay",document.body.appendChild(t),t.addEventListener("click",()=>{const a=document.getElementById("date-dropdown-menu");a&&(a.style.display="none",t.style.display="none")})),t}function v(){console.log("Estado actual de filtros:"),console.log("Título:",document.getElementById("search-title").value),console.log("Fecha:",document.getElementById("release-date-filter").value),console.log("Orden:",document.getElementById("sort-by").value),console.log("Texto botón fecha:",document.getElementById("date-filter-btn").textContent),console.log("Texto botón orden:",document.getElementById("sort-by-btn").textContent)}document.addEventListener("DOMContentLoaded",O);document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{console.log("Verificando elementos DOM después de carga:"),console.log("- Dropdown fecha items:",document.querySelectorAll("#date-dropdown-menu .dropdown-item").length),console.log("- Dropdown orden items:",document.querySelectorAll("#sort-dropdown-menu .dropdown-item").length),console.log("- Release date input:",document.getElementById("release-date-filter")?"Encontrado":"No encontrado"),console.log("- Sort by input:",document.getElementById("sort-by")?"Encontrado":"No encontrado"),v()},1e3)});function N(){const t=document.body,a=document.querySelector(".theme-icon-light"),o=document.querySelector(".theme-icon-dark"),l=document.getElementById("theme-toggle"),e=t.classList.toggle("dark-mode");t.classList.toggle("bg-dark",e),t.classList.toggle("bg-light",!e),t.classList.toggle("text-white",e),t.classList.toggle("text-dark",!e),document.querySelector(".container").classList.toggle("dark-mode",e),document.querySelectorAll(".card").forEach(n=>{n.classList.toggle("dark-mode",e)}),l.classList.add("theme-toggle-active"),setTimeout(()=>{l.classList.remove("theme-toggle-active")},700),e?(a.classList.add("theme-icon-animate-out"),setTimeout(()=>{a.style.display="none",o.style.display="block",o.classList.add("theme-icon-animate-in"),setTimeout(()=>{o.classList.remove("theme-icon-animate-in")},500)},450)):(o.classList.add("theme-icon-animate-out"),setTimeout(()=>{o.style.display="none",a.style.display="block",a.classList.add("theme-icon-animate-in"),setTimeout(()=>{a.classList.remove("theme-icon-animate-in")},500)},450)),localStorage.setItem("darkMode",e)}document.addEventListener("DOMContentLoaded",()=>{var c;const t=document.getElementById("theme-toggle"),a=document.querySelector(".theme-icon-light"),o=document.querySelector(".theme-icon-dark"),l=localStorage.getItem("darkMode"),e=window.matchMedia("(prefers-color-scheme: dark)");let n=!1;l!==null?n=l==="true":n=e.matches;const s=document.body;s.classList.toggle("dark-mode",n),s.classList.toggle("bg-dark",n),s.classList.toggle("bg-light",!n),s.classList.toggle("text-white",n),s.classList.toggle("text-dark",!n),(c=document.querySelector(".container"))==null||c.classList.toggle("dark-mode",n),document.querySelectorAll(".card").forEach(i=>{i.classList.toggle("dark-mode",n)}),a.style.display=n?"none":"block",o.style.display=n?"block":"none",t.addEventListener("click",N)});
